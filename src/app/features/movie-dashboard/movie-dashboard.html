<main class="page">
  <section class="hero">
    <div class="hero__content">
      <p class="hero__eyebrow">MovieAI · Powered by OpenAI</p>
      <h1 class="hero__title">What do you feel like watching tonight?</h1>
      <p class="hero__subtitle">
        Pick a mood, describe the vibe in a few words, and MovieAI will surface up to five film
        ideas instantly.
      </p>

      <div class="hero__controls">
        <label class="search">
          <span class="search__label">Describe the experience</span>
          <div class="search__input-wrapper">
            <input
              type="search"
              class="search__input"
              placeholder="e.g. cozy mystery with a twist, heartfelt drama, adrenaline space mission..."
              [value]="searchTerm()"
              (input)="updateSearch($event.target.value)"
            />
            @if (searchTerm().trim()) {
            <button type="button" class="search__clear" (click)="clearSearch()">Clear</button>
            }
          </div>
        </label>

        <div class="control-group">
          <span class="control-group__label">Optional mood filter</span>
          <div class="chip-row">
            @for (mood of moods; track mood) {
            <button
              type="button"
              class="chip"
              [class.chip--active]="selectedMood() === mood"
              [attr.aria-pressed]="selectedMood() === mood"
              (click)="updateMood(mood)"
            >
              {{ mood }}
            </button>
            }
          </div>
          <span class="control-group__hint">Leave all moods unselected for broader results.</span>
        </div>
      </div>
    </div>

    @if (highlight(); as heroMovie) {
    <article class="hero-card">
      <div class="hero-card__body">
        <span class="hero-card__tag">{{ heroTag() }}</span>
        <h2 class="hero-card__title">{{ heroMovie.title }}</h2>
        <p class="hero-card__meta">
          {{ formatMeta(heroMovie) || 'Details incoming' }}
        </p>
        <p class="hero-card__overview">
          {{ heroMovie.overview }}
        </p>
        @if (heroMovie.watchReasons.length) {
        <div class="watch-reasons">
          @for (reason of heroMovie.watchReasons; track reason) {
          <span class="watch-reasons__pill">{{ reason }}</span>
          }
        </div>
        }
        <div class="hero-card__footer">
          <div class="platforms">
            @if (heroMovie.whereToWatch.length) { @for (platform of heroMovie.whereToWatch; track
            platform) {
            <span class="platforms__pill">{{ platform }}</span>
            } } @else {
            <span class="platforms__pill platforms__pill--placeholder">Availability unknown</span>
            }
          </div>
        </div>
      </div>
    </article>
    } @else {
    <article class="hero-card hero-card--empty">
      <div class="hero-card__empty-state">
        <h2>Start with a few words</h2>
        <p>Try something like "feel-good sports comeback" or "slow sci-fi mystery" to begin.</p>
      </div>
    </article>
    }
  </section>

  <section class="recommendations">
    <header class="recommendations__header">
      <div>
        <h3>Recommendation list</h3>
        <p>
          @if (isUsingOpenAi()) {
          {{ displayMovies().length }} results · Generated by OpenAI } @else { Type a prompt to see
          suggestions }
        </p>
      </div>
      <div
        class="ai-indicator"
        [class.ai-indicator--loading]="aiStatus() === 'loading'"
        [class.ai-indicator--ready]="aiStatus() === 'ready'"
        [class.ai-indicator--error]="aiStatus() === 'error'"
      >
        @switch (aiStatus()) { @case ('loading') { <span>Contacting OpenAI...</span> } @case
        ('ready') { <span>Suggestions ready</span> } @case ('error') { <span>OpenAI error</span> }
        @default { <span>Standing by</span> } }
      </div>
    </header>

    @if (aiError(); as errorMessage) {
    <div class="ai-error"><strong>Heads up:</strong> {{ errorMessage }}</div>
    } @if (supportingMovies().length > 0) {
    <div class="movie-grid">
      @for (movie of supportingMovies(); track movie.title) {
      <article class="movie-card movie-card--openai">
        <div class="movie-card__body">
          <div class="movie-card__header">
            <h4 class="movie-card__title">{{ movie.title }}</h4>
            <span class="movie-card__badge">AI</span>
          </div>
          <p class="movie-card__meta">
            {{ formatMeta(movie) || 'Details not provided' }}
          </p>
          <p class="movie-card__overview">
            {{ movie.overview }}
          </p>
          @if (movie.watchReasons.length) {
          <div class="watch-reasons watch-reasons--inline">
            @for (reason of movie.watchReasons; track reason) {
            <span class="watch-reasons__pill">{{ reason }}</span>
            }
          </div>
          }
        </div>
        <footer class="movie-card__footer">
          <div class="platforms">
            @if (movie.whereToWatch.length) { @for (platform of movie.whereToWatch; track platform)
            {
            <span class="platforms__pill">{{ platform }}</span>
            } } @else {
            <span class="platforms__pill platforms__pill--placeholder">Availability unknown</span>
            }
          </div>
        </footer>
      </article>
      }
    </div>
    } @else if (highlight()) {
    <div class="empty-state">
      <h4>Only one match so far</h4>
      <p>Broaden your prompt or switch moods to reveal more variety.</p>
    </div>
    }
  </section>
</main>
